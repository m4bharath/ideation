CREATE TABLE file_storage (
    id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    file_name VARCHAR2(255),
    file_content CLOB,
    image_content BLOB
);


import os
import cx_Oracle

# Connect to Oracle database
connection = cx_Oracle.connect("username", "password", "localhost:1521/orcl")

# Function to determine if the file is binary based on its extension
def is_binary(filename):
    binary_extensions = {".jpg", ".jpeg", ".png"}
    _, ext = os.path.splitext(filename)
    return ext.lower() in binary_extensions

# Function to insert file into Oracle table
def insert_file(filename):
    cursor = connection.cursor()
    try:
        with open(filename, 'rb') as f:
            file_content = f.read()
            if is_binary(filename):
                cursor.execute("INSERT INTO file_storage (file_name, image_content) VALUES (:file_name, :file_content)", 
                               file_name=filename, file_content=file_content)
            else:
                cursor.execute("INSERT INTO file_storage (file_name, file_content) VALUES (:file_name, :file_content)", 
                               file_name=filename, file_content=file_content)
            connection.commit()
            print(f"File '{filename}' inserted successfully.")
    except Exception as e:
        print(f"Error inserting file '{filename}':", e)
    finally:
        cursor.close()

# Function to retrieve file from Oracle table
def retrieve_file(filename):
    cursor = connection.cursor()
    try:
        cursor.execute("SELECT file_content, image_content FROM file_storage WHERE file_name = :file_name", 
                       file_name=filename)
        row = cursor.fetchone()
        if row:
            file_content, image_content = row
            if file_content:
                with open(f"retrieved_{filename}", 'wb') as f:
                    f.write(file_content.read())
            elif image_content:
                with open(f"retrieved_{filename}", 'wb') as f:
                    f.write(image_content.read())
            print(f"File '{filename}' retrieved successfully.")
        else:
            print(f"No file found with name '{filename}'.")
    except Exception as e:
        print(f"Error retrieving file '{filename}':", e)
    finally:
        cursor.close()

# Example usage: iterate through files in a directory and insert them into the Oracle table
directory = "/path/to/your/directory"
for filename in os.listdir(directory):
    if os.path.isfile(os.path.join(directory, filename)):
        insert_file(os.path.join(directory, filename))

# Retrieve a file from the Oracle table
filename_to_retrieve = "example.txt"
retrieve_file(filename_to_retrieve)

# Close database connection
connection.close()
